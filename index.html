<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Shape of a Cohort</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600&family=JetBrains+Mono:wght@300;400&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: #0a0a0a;
    color: #e8e0d4;
    font-family: 'DM Sans', sans-serif;
    overflow: hidden;
    height: 100vh;
    width: 100vw;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-end;
  }

  #title-bar {
    position: fixed;
    top: 0; left: 0; right: 0;
    padding: 28px 40px;
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    z-index: 10;
    opacity: 0;
    animation: fadeIn 1s ease 0.5s forwards;
  }

  #title-bar h1 {
    font-size: 13px;
    font-weight: 500;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: #666;
  }

  #session-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    font-weight: 300;
    color: #555;
    letter-spacing: 0.05em;
  }

  #canvas-area {
    width: 100%;
    flex: 1;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    padding: 0 60px 0 60px;
    position: relative;
  }

  #skyline {
    display: flex;
    align-items: flex-end;
    justify-content: center;
    gap: 6px;
    height: 70vh;
    position: relative;
  }

  .bar-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: crosshair;
    position: relative;
  }

  .bar {
    width: 12px;
    border-radius: 2px 2px 0 0;
    transition: height 0.6s cubic-bezier(0.23, 1, 0.32, 1), background 0.6s ease;
    position: relative;
    min-height: 8px;
  }

  .bar::after {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 3px;
    background: rgba(255,255,255,0.15);
    border-radius: 2px 2px 0 0;
  }

  .bar-wrapper:hover .bar {
    filter: brightness(1.3);
    box-shadow: 0 -8px 30px rgba(255,255,255,0.06);
  }

  .tooltip {
    position: absolute;
    bottom: calc(100% + 14px);
    left: 50%;
    transform: translateX(-50%);
    background: #1a1a1a;
    border: 1px solid #333;
    padding: 10px 14px;
    border-radius: 6px;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s ease;
    z-index: 100;
  }

  .bar-wrapper:hover .tooltip {
    opacity: 1;
  }

  .tooltip .archetype {
    font-size: 12px;
    font-weight: 500;
    color: #e8e0d4;
    margin-bottom: 3px;
  }

  .tooltip .detail {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    color: #777;
  }

  #timeline {
    width: calc(100% - 120px);
    padding: 20px 0 36px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
    opacity: 0;
    animation: fadeIn 0.8s ease 1s forwards;
  }

  #timeline::before {
    content: '';
    position: absolute;
    top: 20px;
    left: 0; right: 0;
    height: 1px;
    background: #2a2a2a;
  }

  .tick {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    z-index: 2;
  }

  .tick-dot {
    width: 5px;
    height: 5px;
    border-radius: 50%;
    background: #333;
    margin-bottom: 10px;
    transition: background 0.4s ease, box-shadow 0.4s ease;
  }

  .tick-dot.active {
    background: #c4956a;
    box-shadow: 0 0 8px rgba(196, 149, 106, 0.4);
  }

  .tick-dot.passed {
    background: #665840;
  }

  .tick-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    color: #444;
    transition: color 0.4s ease;
  }

  .tick-label.active {
    color: #c4956a;
  }

  .tick-label.passed {
    color: #665840;
  }

  #tagline {
    position: fixed;
    bottom: 50%;
    left: 50%;
    transform: translate(-50%, 50%);
    text-align: center;
    opacity: 0;
    pointer-events: none;
    z-index: 50;
    transition: opacity 1.2s ease;
  }

  #tagline.visible {
    opacity: 1;
  }

  #tagline h2 {
    font-size: 28px;
    font-weight: 300;
    letter-spacing: 0.04em;
    color: #e8e0d4;
    margin-bottom: 8px;
  }

  #tagline p {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: #666;
    letter-spacing: 0.06em;
  }

  #restart-btn {
    position: fixed;
    bottom: 90px;
    left: 50%;
    transform: translateX(-50%);
    background: none;
    border: 1px solid #333;
    color: #666;
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 8px 20px;
    border-radius: 20px;
    cursor: pointer;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.8s ease, border-color 0.3s, color 0.3s;
    z-index: 50;
  }

  #restart-btn.visible {
    opacity: 1;
    pointer-events: auto;
  }

  #restart-btn:hover {
    border-color: #c4956a;
    color: #c4956a;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  /* Glow line at the base */
  #glow-line {
    position: fixed;
    bottom: 76px;
    left: 60px; right: 60px;
    height: 1px;
    background: linear-gradient(90deg, transparent, #2a2a2a 20%, #2a2a2a 80%, transparent);
  }
</style>
</head>
<body>

<div id="title-bar">
  <h1>The Shape of a Cohort</h1>
  <span id="session-label">Session —</span>
</div>

<div id="canvas-area">
  <div id="skyline"></div>
</div>

<div id="glow-line"></div>

<div id="timeline"></div>

<div id="tagline">
  <h2>No two learners walk the same path</h2>
  <p>30 students · 14 sessions · infinite trajectories</p>
</div>

<button id="restart-btn">Replay</button>

<script>
const STUDENTS = 30;
const SESSIONS = 14;
const MAX_HEIGHT_VH = 65;
const SESSION_DURATION = 900; // ms per session

// Archetypes with trajectory functions
const archetypes = [
  {
    name: "Steady Contributor",
    color: "steady",
    count: 6,
    trajectory: (s, seed) => {
      const rate = 0.55 + seed * 0.3;
      return Math.min(rate * (s / SESSIONS), 0.95);
    }
  },
  {
    name: "Early Riser",
    color: "early",
    count: 4,
    trajectory: (s, seed) => {
      const peak = 0.7 + seed * 0.25;
      return peak * (1 - Math.exp(-0.35 * s));
    }
  },
  {
    name: "Late Bloomer",
    color: "late",
    count: 5,
    trajectory: (s, seed) => {
      const inflection = 6 + seed * 3;
      const sig = 1 / (1 + Math.exp(-0.7 * (s - inflection)));
      return sig * (0.7 + seed * 0.25);
    }
  },
  {
    name: "Fading Voice",
    color: "fading",
    count: 4,
    trajectory: (s, seed) => {
      const peak = 3 + seed * 2;
      const maxVal = 0.5 + seed * 0.3;
      if (s <= peak) return maxVal * (s / peak);
      return Math.max(0.08, maxVal * Math.exp(-0.15 * (s - peak)));
    }
  },
  {
    name: "Quiet Observer",
    color: "quiet",
    count: 4,
    trajectory: (s, seed) => {
      const base = 0.08 + seed * 0.12;
      const wobble = Math.sin(s * 0.5 + seed * 3) * 0.04;
      return Math.max(0.05, base + wobble + s * 0.008);
    }
  },
  {
    name: "Burst Performer",
    color: "burst",
    count: 3,
    trajectory: (s, seed) => {
      const burstAt = 4 + Math.floor(seed * 6);
      let val = 0.15 + seed * 0.1;
      if (Math.abs(s - burstAt) < 2) val = 0.7 + seed * 0.2;
      if (s > burstAt + 2) val = 0.3 + seed * 0.15;
      return val;
    }
  },
  {
    name: "The Transformer",
    color: "transformer",
    count: 2,
    trajectory: (s, seed) => {
      if (s < 7) return 0.1 + seed * 0.08 + s * 0.01;
      return Math.min(0.95, 0.15 + (s - 7) * (0.1 + seed * 0.04));
    }
  },
  {
    name: "Consistent Star",
    color: "star",
    count: 2,
    trajectory: (s, seed) => {
      return Math.min(0.92 + seed * 0.06, 0.5 + s * 0.035 + seed * 0.1);
    }
  }
];

// Build student data
function buildStudents() {
  const students = [];
  let id = 0;
  archetypes.forEach(arch => {
    for (let i = 0; i < arch.count; i++) {
      const seed = Math.random();
      const values = [];
      for (let s = 0; s <= SESSIONS; s++) {
        values.push(arch.trajectory(s, seed));
      }
      students.push({ id: id++, archetype: arch.name, values, seed });
    }
  });
  // Shuffle
  for (let i = students.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [students[i], students[j]] = [students[j], students[i]];
  }
  return students;
}

// Color interpolation: cool grey -> warm amber
function getColor(value) {
  const t = Math.max(0, Math.min(1, value));
  // Grey: rgb(90, 90, 95) -> Amber: rgb(210, 160, 90)
  const r = Math.round(90 + t * 120);
  const g = Math.round(90 + t * 70);
  const b = Math.round(95 - t * 5);
  return `rgb(${r}, ${g}, ${b})`;
}

function getGlowColor(value) {
  const t = Math.max(0, Math.min(1, value));
  return `rgba(210, 160, 90, ${t * 0.15})`;
}

let students = buildStudents();
let currentSession = 0;
let animating = false;

const skyline = document.getElementById('skyline');
const timeline = document.getElementById('timeline');
const sessionLabel = document.getElementById('session-label');
const tagline = document.getElementById('tagline');
const restartBtn = document.getElementById('restart-btn');

function createBars() {
  skyline.innerHTML = '';
  students.forEach((st, i) => {
    const wrapper = document.createElement('div');
    wrapper.className = 'bar-wrapper';

    const bar = document.createElement('div');
    bar.className = 'bar';
    bar.id = `bar-${i}`;
    bar.style.height = '8px';
    bar.style.background = getColor(0);

    const tooltip = document.createElement('div');
    tooltip.className = 'tooltip';
    tooltip.innerHTML = `
      <div class="archetype">${st.archetype}</div>
      <div class="detail">Student ${st.id + 1}</div>
    `;

    wrapper.appendChild(tooltip);
    wrapper.appendChild(bar);
    skyline.appendChild(wrapper);
  });
}

function createTimeline() {
  timeline.innerHTML = '';
  for (let s = 1; s <= SESSIONS; s++) {
    const tick = document.createElement('div');
    tick.className = 'tick';
    tick.innerHTML = `
      <div class="tick-dot" id="dot-${s}"></div>
      <div class="tick-label" id="label-${s}">${s}</div>
    `;
    timeline.appendChild(tick);
  }
}

function updateBars(session) {
  students.forEach((st, i) => {
    const bar = document.getElementById(`bar-${i}`);
    const val = st.values[session] || 0;
    const height = Math.max(8, val * MAX_HEIGHT_VH);
    bar.style.height = `${height}vh`;
    bar.style.background = getColor(val);
    bar.style.boxShadow = `0 -4px 20px ${getGlowColor(val)}`;
  });
}

function updateTimeline(session) {
  for (let s = 1; s <= SESSIONS; s++) {
    const dot = document.getElementById(`dot-${s}`);
    const label = document.getElementById(`label-${s}`);
    dot.className = 'tick-dot';
    label.className = 'tick-label';
    if (s === session) {
      dot.classList.add('active');
      label.classList.add('active');
    } else if (s < session) {
      dot.classList.add('passed');
      label.classList.add('passed');
    }
  }
  if (session > 0) {
    sessionLabel.textContent = `Session ${String(session).padStart(2, '0')} / ${SESSIONS}`;
  } else {
    sessionLabel.textContent = 'Session —';
  }
}

function animate() {
  if (animating) return;
  animating = true;
  currentSession = 0;
  tagline.classList.remove('visible');
  restartBtn.classList.remove('visible');

  updateBars(0);
  updateTimeline(0);

  let session = 1;
  const interval = setInterval(() => {
    updateBars(session);
    updateTimeline(session);
    currentSession = session;

    if (session >= SESSIONS) {
      clearInterval(interval);
      animating = false;
      setTimeout(() => {
        tagline.classList.add('visible');
        restartBtn.classList.add('visible');
      }, 800);
    }
    session++;
  }, SESSION_DURATION);
}

restartBtn.addEventListener('click', () => {
  students = buildStudents();
  createBars();
  tagline.classList.remove('visible');
  restartBtn.classList.remove('visible');
  setTimeout(animate, 400);
});

// Init
createBars();
createTimeline();
setTimeout(animate, 1500);
</script>
</body>
</html>
